graph TD
    subgraph "é˜¶æ®µä¸€ï¼šæ•è· & æŒä¹…åŒ–"
        direction LR
        User[ğŸ‘¤ ç”¨æˆ·] --> Browser(ğŸŒ Chromeæµè§ˆå™¨)
        Browser -- "CDPäº‹ä»¶æµ (è¯·æ±‚/å“åº”)" --> Controller[CDPæ§åˆ¶å™¨]
        Controller --> Q1[åŸå§‹äº‹ä»¶é˜Ÿåˆ—]
        Q1 --> Filter[è¿‡æ»¤å™¨Worker<br/>(ç™½åå•/é™æ€èµ„æº/JSæ–‡ä»¶)]
        Filter --> Q2[ç²¾ç‚¼ä¸Šä¸‹æ–‡é˜Ÿåˆ—]
        Q2 --> Writer(Jsonlå†™å…¥å™¨)
        Writer -- "è¿½åŠ å†™å…¥" --> FileBuffer([ğŸ“„<br/>data/capture.jsonl])
    end

    subgraph "é˜¶æ®µäºŒï¼šè¯»å– & åˆ†æ"
        direction LR
        FileBuffer -- "å®æ—¶è¿½è¸ª" --> Reader(Jsonlè¯»å–å™¨)
        Reader --> Q_Task[åˆ†æä»»åŠ¡é˜Ÿåˆ—]
        Q_Task --> Dispatcher[æ™ºèƒ½è°ƒåº¦å‘˜]
        Dispatcher --> Q_Soft[è½¯æ¼æ´é˜Ÿåˆ—]
        Dispatcher --> Q_Reverse[é€†å‘åˆ†æé˜Ÿåˆ—]
        Dispatcher --> Q_JS[JSåˆ†æé˜Ÿåˆ—]

        subgraph "å¹¶è¡ŒAIåˆ†ææ ¸å¿ƒ (x3)"
            direction TB
            Q_Soft --> AI_Soft[AI Worker - Soft]
            Q_Reverse --> AI_Reverse[AI Worker - Reverse]
            Q_JS --> AI_JS[AI Worker - JS]
        end

        AI_Soft -- "ç»“æ„åŒ–JSON" --> Q_Out[ç»Ÿä¸€AIç»“æœé˜Ÿåˆ—]
        AI_Reverse -- "ç»“æ„åŒ–JSON" --> Q_Out
        AI_JS -- "ç»“æ„åŒ–JSON" --> Q_Out
    end

    subgraph "å¤–éƒ¨æœåŠ¡ & æ—¥å¿—"
        direction TB
        Prompts([ğŸ“„<br/>prompts.py])
        LLM_VDB[LLMæœåŠ¡ (Ollama)<br/>&<br/>å‘é‡æ•°æ®åº“ (ChromaDB)]
        AILog([ğŸ“„<br/>logs/ai_dialogues.jsonl])
    end

    subgraph "é˜¶æ®µä¸‰ï¼šå¹¿æ’­ & è¾“å‡º"
        direction LR
        Q_Out --> Broadcaster[å¹¿æ’­å™¨]
        Broadcaster --> Q_Report[æŠ¥å‘Šé˜Ÿåˆ—]
        Broadcaster --> Q_Memory[è®°å¿†é˜Ÿåˆ—]

        subgraph "å¹¶è¡Œæœ€ç»ˆå¤„ç†"
            direction TB
            Q_Report --> Reporter(æŠ¥å‘Šç”Ÿæˆå™¨)
            Q_Memory --> Memory(è®°å¿†æ²‰æ·€å™¨)
        end
        Reporter -- "å†™å…¥ç»“æ„åŒ–æŠ¥å‘Š" --> ReportFile([ğŸ“„<br/>reports/*.md])
    end

    %% äº¤äº’å…³ç³»
    AI_Soft -- "è°ƒç”¨Prompt" --> Prompts
    AI_Reverse -- "è°ƒç”¨Prompt" --> Prompts
    AI_JS -- "è°ƒç”¨Prompt" --> Prompts
    AI_Soft -- "RAG/æ¨ç†" --> LLM_VDB
    AI_Reverse -- "RAG/æ¨ç†" --> LLM_VDB
    AI_JS -- "RAG/æ¨ç†" --> LLM_VDB
    AI_Soft -- "è®°å½•å¯¹è¯" --> AILog
    AI_Reverse -- "è®°å½•å¯¹è¯" --> AILog
    AI_JS -- "è®°å½•å¯¹è¯" --> AILog
    Memory -- "å†™å…¥è®°å¿†" --> LLM_VDB

    classDef stage fill:#E8F8F5,stroke:#16A085,stroke-width:2px
    classDef services fill:#FEF9E7,stroke:#F1C40F,stroke-width:2px
    class User,Browser,FileBuffer,AILog,ReportFile,LLM_VDB,Prompts services
    class Controller,Filter,Writer,Reader,Dispatcher,AI_Soft,AI_Reverse,AI_JS,Broadcaster,Reporter,Memory,Q1,Q2,Q_Task,Q_Soft,Q_Reverse,Q_JS,Q_Out,Q_Report,Q_Memory stage