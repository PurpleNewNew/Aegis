graph TB
    %% Main Application Boundary
    subgraph "Aegis-CLI Application (æœ¬åœ°Pythonåº”ç”¨)"
        direction TB

        %% 1. Entry Point & Data Ingestion
        Controller[<b>CDP Controller</b><br/>æ•°æ®é‡‡é›†å™¨]

        %% 2. Queues & Workers Pipeline
        Q1[â‘  åŸå§‹äº‹ä»¶é˜Ÿåˆ—]
        FilterWorker[<b>Filter & Prune Worker</b><br/>ç­›é€‰ä¸å‰ªæ]
        Q2[â‘¡ ç²¾ç‚¼ä¸Šä¸‹æ–‡é˜Ÿåˆ—]
        Dispatcher[<b>Dispatcher</b><br/>æ™ºèƒ½è°ƒåº¦å‘˜]

        subgraph "å¹¶è¡Œåˆ†ææ ¸å¿ƒ"
            direction LR
            subgraph "è½¯æ¼æ´åˆ†æ"
                Q_Soft[â‘¢-a Soft Queue] --> AI_Soft[AI Worker - Soft]
            end
            subgraph "é€†å‘åˆ†æ"
                Q_Reverse[â‘¢-b Reverse Queue] --> AI_Reverse[AI Worker - Reverse]
            end
        end

        Q_Final[â‘£ æœ€ç»ˆç»“æœé˜Ÿåˆ—]

        subgraph "å¹¶è¡Œæœ€ç»ˆå¤„ç†"
            direction LR
            ReporterWorker[<b>Reporter Worker</b><br/>æŠ¥å‘Šç”Ÿæˆ]
            MemoryWorker[<b>Memory Worker</b><br/>è®°å¿†æ²‰æ·€]
        end

        %% Internal Data Flow
        Controller --> Q1
        Q1 --> FilterWorker
        FilterWorker --> Q2
        Q2 --> Dispatcher
        Dispatcher --> Q_Soft
        Dispatcher --> Q_Reverse
        AI_Soft --> Q_Final
        AI_Reverse --> Q_Final
        Q_Final --> ReporterWorker
        Q_Final --> MemoryWorker
    end

    %% External Interactions (Arrows clearly connecting to specific components)
    User[ğŸ‘¤<br/>ç”¨æˆ·] -- "1. è¿è¡ŒCLIæŒ‡ä»¤" --> Controller
    Browser(ğŸŒ<br/>Chromeæµè§ˆå™¨) -- "2. å‘é€CDPäº‹ä»¶æµ" --> Controller

    AI_Soft -- "5a. RAGè¯»/LLMæ¨ç†" --> LLM_VDB
    AI_Reverse -- "5b. RAGè¯»/LLMæ¨ç†" --> LLM_VDB

    subgraph "å¤–éƒ¨æœåŠ¡"
        LLM_VDB[LLMæœåŠ¡ (Ollama/GPT)<br/>&<br/>å‘é‡æ•°æ®åº“ (ChromaDB)]
    end

    MemoryWorker -- "6. å†™å…¥æ–°çŸ¥è¯†" --> LLM_VDB

    ReporterWorker -- "7. è¾“å‡ºæŠ¥å‘Š" --> FileSystem(ğŸ“„<br/>./reports)

    %% Styling
    classDef internal fill:#D6EAF8,stroke:#5DADE2
    classDef external fill:#D5F5E3,stroke:#58D68D
    class Controller,FilterWorker,Dispatcher,AI_Soft,AI_Reverse,ReporterWorker,MemoryWorker,Q1,Q2,Q_Soft,Q_Reverse,Q_Final internal
    class User,Browser,LLM_VDB,FileSystem external